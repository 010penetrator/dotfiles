" vim: ts=4 sw=4 ft=vim
" Kind of header config file for Vim/Neovim
" 1. get plug.vim
" 2. :PlugUpdate
" 3. :checkhealth
" 4. set up Mason
" 5. check if LSP works well

let g:bash_forced=0
if ( !empty($MSYSTEM) && has("nvim") )
    echo "Will force Msys shell!"
    let g:bash_forced=1
    set shell=\msys64/usr/bin/bash
    set shellcmdflag=-c
    set sxq=
endif
if $ComSpec =~ "cmd.exe$"
    " echo "We have cmd prompt.."
endif

" if empty($sh) | echom 11 expand('%') | endif
let $VICONFD=split(&runtimepath, ',')[0]
if !empty($sh)
    let $MYVIMRC = $sh . "/vi/vimrc_main"
endif
if !empty($git)
    let $PLUGD = $git . "/nvpl"
else
    if isdirectory($sh . "/../../nvpl")
        let $PLUGD = resolve($sh . "/../../nvpl")
    endif
endif
let $MYAUTOLOAD = expand('$VICONFD') . "/autoload"

if !empty(g:bash_forced)
    let g:my_autoload_nix = system('cygpath -u "$MYAUTOLOAD" | tr -d "\n"')
    "let $PLUGD = system('cygpath -u "$PLUGD" | tr -d "\n"')
    "let $VICONFD = system('cygpath "$VICONFD"')
endif

command! -nargs=1 SSource if filereadable(expand('<args>')) | source <args> | endif

if ( !isdirectory($vi) && isdirectory($sh."/vi") )
    let $vi = $sh .  "/vi"
endif
let $mylua = $sh . "/vi/lua/plasmik"

set runtimepath+=$vi
" set runtimepath+=$mylua

if has("nvim")
    SSource $vi/myvimrc
    SSource $mylua/init.lua
    silent call ReloadStyle(1)
    " SSource $vi/vimrc_themes
    " SSource $mylua/helpy.lua
    " SSource $mylua/remap.lua
else
    SSource $vi/vimrc_plug
    SSource $vi/myvimrc
    " SSource $vi/vimrc_themes
    SSource $loc/vimrc.local
endif

" TODO/Problems :
"     filetype detection needs :e!
"     tame completion
"     tame tests like nvim-neotest
"     tame debug like nvim-dap
"     try lspsaga
"     try emmet
"     try snippets
"     why <Esc>j == <A-j>


" vim: ts=4 sw=4 ft=vim
" Kind of header config file for Vim/Neovim

let g:bash_forced=0
if ( !empty($MSYSTEM) && has("nvim") )
    echo "Will force Msys shell!"
    let g:bash_forced=1
    set shell=\msys64/usr/bin/bash
    set shellcmdflag=-c
    set sxq=
endif
if $ComSpec =~ "cmd.exe$"
    " echo "We have cmd prompt.."
endif

let $VICONFD=split(&runtimepath, ',')[0]
if !empty($sh)
    let $MYVIMRC = $sh . "/vi/vimrc_main"
endif
if !empty($git)
    let $PLUGD = $git . "/plugged"
else
    if isdirectory($sh . "/../../plugged")
        let $PLUGD = $sh . "/../../plugged"
    endif
endif
let $MYAUTOLOAD = expand('$VICONFD') . "/autoload"

if !empty(g:bash_forced)
    let g:my_autoload_nix = system('cygpath -u "$MYAUTOLOAD" | tr -d "\n"')
    "let $PLUGD = system('cygpath -u "$PLUGD" | tr -d "\n"')
    "let $VICONFD = system('cygpath "$VICONFD"')
endif

command! -nargs=1 SSource if filereadable(expand('<args>')) | source <args> | endif

if ( !isdirectory($vi) && isdirectory($sh."/vi") )
    let $vi = $sh .  "/vi"
endif

" SSource $HOME/.vimrc_msys
SSource $vi/myvimrc
SSource $vi/vimrc_plug
SSource $vi/vimrc_themes
SSource $loc/vimrc.local

if has("nvim")
    SSource $vi/init.lua
    SSource $vi/nvim-lsp.lua
endif

" TODO/Problems :
"     ft detection is sleepy
"     lsp client exits with 1
"     less completion

